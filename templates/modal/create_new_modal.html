<div class="modal fade" id="createNewModal" tabindex="-1" aria-labelledby="createNewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createNewModalLabel">Request Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Tabs Navigation -->
                <ul class="nav nav-tabs mb-3" id="createDetailsTabPane" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="details-tab2" data-bs-toggle="tab"
                            data-bs-target="#details-tab-pane" type="button" role="tab" aria-controls="details-tab-pane"
                            aria-selected="true">
                            Details
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Details Tab -->
                    <div class="tab-pane fade show active" id="details-tab-pane2" role="tabpanel"
                        aria-labelledby="details-tab">
                        <form id="detailsForm2" hx-post="/create-new/{{ model_name }}" hx-trigger="submit"
                            hx-swap="none" hx-on="htmx:afterRequest:window.location.reload()">
                            <!-- Predefined Fields for "is_request" Models -->
                            {% include "modal/form_fields.html" %}
                            <input type="hidden" id="relationshipsInput" name="relationships" value="">

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Include your JS (Bootstrap, jQuery, or vanilla) -->
<script>
    // A global object to store relationship rows in memory
    let relationshipsData = {};
  
    // Existing logic: add a row to the <tbody> each time user clicks ".add-row-btn"
    document.body.addEventListener("click", (event) => {
      if (event.target.matches(".add-row-btn")) {
        const relationshipName = event.target.dataset.relationship;
        const table = event.target.closest("table");
        const tbody = table.querySelector("tbody");
  
        // Grab each input in the same row
        const rowInputs = table.querySelectorAll(".add-field-input");
        const rowData = {};
  
        rowInputs.forEach(input => {
          const fieldName = input.dataset.field;
          rowData[fieldName] = input.value;
        });
  
        // --- 1) Render a new row in the table (your existing code) ---
        const newRow = document.createElement("tr");
        for (const [colName, val] of Object.entries(rowData)) {
          const td = document.createElement("td");
          td.textContent = val;
          newRow.appendChild(td);
        }
  
        // Actions cell
        const actionsTd = document.createElement("td");
        actionsTd.innerHTML = `
          <button type="button" class="btn btn-danger btn-sm remove-row-btn">
            Remove
          </button>
        `;
        newRow.appendChild(actionsTd);
  
        // Append to tbody
        tbody.appendChild(newRow);
  
        // Clear inputs
        rowInputs.forEach(i => (i.value = ""));
  
        // --- 2) Also store rowData in relationshipsData ---
        if (!relationshipsData[relationshipName]) {
          relationshipsData[relationshipName] = [];
        }
        relationshipsData[relationshipName].push(rowData);
      }
  
      if (event.target.matches(".remove-row-btn")) {
        event.target.closest("tr").remove();
        // (Optional) If you want to remove it from relationshipsData as well,
        // you'd need a way to find which rowData this "Remove" corresponds to.
        // e.g. storing an index or UUID in the rowâ€™s dataset, then removing from relationshipsData array.
      }
    });
  
    // Before the form is submitted (HTMX will do this on "submit"),
    // copy relationshipsData into a hidden <input> so the server can parse it.
    const form = document.getElementById("detailsForm2");
    form.addEventListener("submit", function() {
      const relationshipsInput = document.getElementById("relationshipsInput");
      relationshipsInput.value = JSON.stringify(relationshipsData);
    });
  </script>
  