{% if "IMPL_Specialist" in user.roles.split(",") %}
<div class="tab-pane fade" id="checklist-tab-pane" role="tabpanel" aria-labelledby="checklist-tab">
    <h5>Checklist</h5>
    <form id="checklistForm">
        <!-- Pass the unique_ref -->
        <input type="hidden" name="unique_ref" value="{{ unique_ref }}">
    
        <!-- Dynamically Generated Fields -->
        <ul>
            {% include "modal/fields.html" %}
        </ul>
    
        <hr>
    
        <!-- Checklist Values -->
        {% for section, checks in check_list.items() %}
        <h6>{{ section }}</h6>
        <div>
            {% for check in checks %}
            <div class="form-check">
                <!-- Hidden input for unchecked values -->
                <input type="hidden" name="checklist_values[{{ check }}]" value="false">
                <input
                    class="form-check-input"
                    type="checkbox"
                    id="{{ check }}"
                    name="checklist_values[{{ check }}]"
                    value="true"
                    style="width: 25px; height: 25px;"
                    {% if item_data.get(check) %}checked{% endif %}
                >
                <label class="form-check-label" for="{{ check }}" style="font-size: 1.2em;">{{ check }}</label>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    
        <!-- Update Button -->
        <div class="modal-footer mt-3">
            <button
                type="button"
                class="btn btn-primary"
                id="updateChecklistButton"
                hx-post="/update-checklist/{{ model_name }}" 
                hx-include="#checklistForm"
                hx-headers='{"Content-Type": "application/x-www-form-urlencoded"}'
                hx-trigger="click"
                hx-swap="innerHTML"
            >
                Update
            </button>
        </div>
    </form>
    
    
    
</div>
{% endif %}

<script>
document.getElementById("updateChecklistButton").addEventListener("click", function () {
    const checkboxes = document.querySelectorAll("#checklistForm .form-check-input");
    const governanceData = {};

    // Combine checkbox values into governanceData
    checkboxes.forEach((checkbox) => {
        const key = checkbox.getAttribute("data-governance-key");
        governanceData[key] = checkbox.checked;
    });

    // Update the hidden input value
    const governanceInput = document.getElementById("governance");
    governanceInput.value = JSON.stringify(governanceData);
});

</script>