<div class="filter-menu" id="filter-{{ key }}">
    <form action="/table/{{ model_name }}" method="GET">
        <!-- Preserve Other Filters -->
        {% for f_key, f_value in filters.items() if f_key != key %}
        <input type="hidden" name="filters[{{ f_key }}]" value="{{ f_value }}">
        {% endfor %}

        {% set column = metadata["columns"] | selectattr("name", "equalto", key) | first %}
        {% set column_options = column.column_options if column and column.column_options else None %}

        {% if column_options %}
        <!-- Predefined Options (Always Multi-Select for columns with options) -->
        <select 
            name="filters[{{ key }}][]" 
            class="form-control form-control-sm filter-select mb-2" 
            multiple>
            {% for option in column_options %}
            <option 
                value="{{ option }}" 
                {% if filters[key] and option in filters[key] %}selected{% endif %}>
                {{ option|capitalize }}
            </option>
            {% endfor %}
        </select>
        {% else %}
        <!-- Default Free-Form Text Input -->
        <input 
            type="text" 
            class="form-control form-control-sm filter-input mb-2" 
            name="filters[{{ key }}]" 
            placeholder="Filter {{ key|capitalize }}"
            value="{{ filters[key] if filters[key] else '' }}">
        {% endif %}

        <!-- Filter Buttons -->
        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-primary btn-sm apply-filter-btn">Apply</button>
            <a href="/table/{{ model_name }}?{% for f_key, f_value in filters.items() if f_key != key %}filters[{{ f_key }}]={{ f_value }}&{% endfor %}" 
                class="btn btn-secondary btn-sm clear-filter-btn">Clear</a>
        </div>
    </form>
</div>
<script>
    
</script>