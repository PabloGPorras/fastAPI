<!-- jQuery-powered button (HTMX attributes removed) -->
<button type="button" class="dropdown-item text-primary view-btn">
    <i class="fas fa-eye"></i> View
</button>
<script>
    $(document).ready(function () {
        $("body").on("click", ".view-btn", function () {
            let uniqueRef = $(this).attr("data-unique-ref");
            let userRoles = "{{ user.roles }}";  // ✅ Injected directly from Jinja2
            let userName = "{{ user.user_name }}";  // ✅ Injected directly from Jinja2
            let model_name = "{{ model_name }}";  // ✅ Injected directly from Jinja2

            console.log(`Fetching details for uniqueRef: ${uniqueRef}`);
            console.log(`Fetching details for userRoles: ${userRoles}`);
            console.log(`Fetching details for modelName: ${model_name}`);

            $.ajax({
                url: "/get-view-existing-form",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ unique_ref: uniqueRef, model_name: model_name, user_roles: userRoles, user_name: userName }),
                success: function (response) {
                    console.log("✅ Data received:", response);

                    // Clear any previously injected modal markup
                    $("#modalContainer").html("");

                    // Inject the entire modal HTML into the container
                    $("#modalContainer").html(response);

                    // Assuming the modal in the response has an id of 'viewExistingModal'
                    $("#viewExistingModal").modal("show");
                },
                error: function (xhr, status, error) {
                    console.error("❌ Error fetching details:", xhr.responseText);
                    alert("Failed to load details. Please try again.");
                }
            });
        });
    });
</script>