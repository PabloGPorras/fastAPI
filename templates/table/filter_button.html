<!-- Filter Icon with Active Indicator -->
<span class="filter-icon {% if filters[key] %}active{% endif %}" data-column="{{ key }}" id="filter-icon-{{ key }}"
    title="Filter">
    üîç
</span>

<script>
    document.addEventListener("DOMContentLoaded", async () => {

        document.querySelectorAll(".filter-icon").forEach((icon) => {
            icon.addEventListener("click", (event) => toggleFilterMenu(event, icon));
        });

        document.addEventListener("click", (event) => {
            if (!event.target.closest(".filter-icon, .filter-menu")) {
                document.querySelectorAll(".filter-menu").forEach((menu) => menu.classList.remove("show"));
            }
        });
    });


    // Toggle filter menu visibility
    function toggleFilterMenu(event, icon) {
        event.stopPropagation();
        const column = icon.dataset.column;
        const filterMenu = document.querySelector(`#filter-${column}`);

        // Hide other menus and toggle this one
        document.querySelectorAll(".filter-menu").forEach((menu) => {
            if (menu !== filterMenu) menu.classList.remove("show");
        });

        if (filterMenu.classList.contains("show")) {
            filterMenu.classList.remove("show");
        } else {
            // Get the bounding rectangle of the filter icon
            const iconRect = icon.getBoundingClientRect();
            const tableBody = document.querySelector("#tableBody"); // Adjust if your table scroll container differs

            // Calculate the position for the filter menu
            const scrollOffset = tableBody.scrollLeft || 0; // Adjust for horizontal scroll
            filterMenu.style.top = `${iconRect.bottom}px`;
            filterMenu.style.left = `${iconRect.left + scrollOffset}px`;

            filterMenu.classList.add("show");
        }
    }

</script>