<!-- Hidden template for filter dropdown -->
<template id="filter-template">
    <div class="filter-group">
        <label class="filter-label"></label> <!-- Column name will be set dynamically -->
        <select class="form-control custom-filter" data-column="">
            <option value="">All</option> <!-- Default "All" option -->
        </select>
    </div>
</template>

<!-- Template for a single free-text filter -->
<template id="free-text-filter-template">
    <div class="filter-group">
        <label class="filter-label"></label>
        <input type="text" class="form-control custom-filter-input" data-column="" placeholder="Enter filter text">
    </div>
</template>


<script>
function setupFilters(table, columnOptions, allColumns) {
    let filterContainer = $("#filterContainer");
    filterContainer.empty(); // Clear previous filters

    // Iterate over all columns (skip any column you don't want filtered, e.g., "actions")
    allColumns.forEach((colName) => {
        if (colName === "actions") return;

        if (columnOptions[colName] && columnOptions[colName].length > 0) {
            // Use the dropdown template for columns with predefined options
            let template = document.getElementById("filter-template");
            let clone = template.content.cloneNode(true);

            let label = clone.querySelector(".filter-label");
            label.textContent = colName.toUpperCase();

            let select = clone.querySelector("select");
            select.setAttribute("data-column", colName);

            columnOptions[colName].forEach((option) => {
                let optionElement = document.createElement("option");
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });

            // Reload DataTable when filter changes
            select.addEventListener("change", function () {
                table.ajax.reload();
            });

            filterContainer.append(clone);
        } else {
            // Use the single free-text input for columns without predefined options
            let template = document.getElementById("free-text-filter-template");
            let clone = template.content.cloneNode(true);

            let label = clone.querySelector(".filter-label");
            label.textContent = colName.toUpperCase();

            let input = clone.querySelector("input");
            input.setAttribute("data-column", colName);

            // Reload DataTable when free text changes (you could also use keyup for instant updates)
            input.addEventListener("change", function () {
                table.ajax.reload();
            });

            filterContainer.append(clone);
        }
    });
}


</script>
